<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netstandard2.0</TargetFramework>
    <AssemblyName>OpenTK</AssemblyName>
    <AssemblyVersion>3.0.0</AssemblyVersion>
    <PackageVersion>3.0.4</PackageVersion>
    <Deterministic>true</Deterministic>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <EnableDefaultItems>false</EnableDefaultItems>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <ProduceReferenceAssembly>True</ProduceReferenceAssembly>
    <DefineConstants>TIZEN;OPENGLES;SDL2;__MOBILE__</DefineConstants>
    <NoWarn>$(NoWarn);CS3021</NoWarn>
  </PropertyGroup>

  <PropertyGroup>
    <TizenNETVersion>5.0.0.14428</TizenNETVersion>
  </PropertyGroup>

  <PropertyGroup>
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <NoPackageAnalysis>true</NoPackageAnalysis>
    <NuspecFile>OpenTK.Tizen.nuspec</NuspecFile>
    <NuspecBasePath>$(MSBuildThisFileDirectory)</NuspecBasePath>
    <NuspecProperties>version=$(PackageVersion);configuration=$(Configuration);fxversion=$(TizenNETVersion)</NuspecProperties>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Tizen.NET" Version="$(TizenNETVersion)" />
  </ItemGroup>

  <ItemGroup>
    <Compile Include="AutoGeneratedAttribute.cs" />
    <Compile Include="CountAttribute.cs" />
    <Compile Include="BindingsBase.cs" />
    <Compile Include="BlittableValueType.cs" />
    <Compile Include="Configuration.cs" />
    <Compile Include="ContextHandle.cs" />
    <Compile Include="DisplayDevice.cs" />
    <Compile Include="DisplayIndex.cs" />
    <Compile Include="DisplayResolution.cs" />
    <Compile Include="Exceptions.cs" />
    <Compile Include="FrameEventArgs.cs" />
    <Compile Include="GameWindow.cs" />
    <Compile Include="GameWindowFlags.cs" />
    <Compile Include="IGameWindow.cs" />
    <Compile Include="INativeWindow.cs" />
    <Compile Include="IntPtrEqualityComparer.cs" />
    <Compile Include="InteropHelper.cs" />
    <Compile Include="KeyPressEventArgs.cs" />
    <Compile Include="Minimal.cs" />
    <Compile Include="MouseCursor.cs" />
    <Compile Include="NativeWindow.cs" />
    <Compile Include="Platform\iPhoneOS\iPhoneDisplayDeviceDriver.cs" />
    <Compile Include="RewrittenAttribute.cs" />
    <Compile Include="SlotAttribute.cs" />
    <Compile Include="Toolkit.cs" />
    <Compile Include="ToolkitOptions.cs" />
    <Compile Include="WindowBorder.cs" />
    <Compile Include="WindowIcon.cs" />
    <Compile Include="WindowState.cs" />
    <Compile Include="Input/*.cs" />
    <Compile Include="Math/*.cs" />
    <Compile Include="Graphics/*.cs" />
    <Compile Include="Graphics/ES11/*.cs" />
    <Compile Include="Graphics/ES20/*.cs" />
    <Compile Include="Graphics/ES30/*.cs" />
    <Compile Include="Platform/*.cs" />
    <Compile Include="Platform/Dummy/*.cs" />
    <Compile Include="Platform/SDL2/*.cs" />
    <Compile Include="Platform/Tizen/*.cs" />
  </ItemGroup>

  <!-- Rewrite OpenTK.dll after building -->
  <Target Name="_AfterBuild" AfterTargets="Build">
    <!-- Copy dependent files to output dir -->
    <ItemGroup>
      <_DependentFilesToCopy Include="@(ResolvedCompileFileDefinitions)" Condition="'%(NuGetPackageId)' == 'Tizen.NET.API5'" />
    </ItemGroup>
    <Copy SourceFiles="@(_DependentFilesToCopy)" DestinationFolder="$(TargetDir)" />

    <!-- Rewrite OpenTK.dll -->
    <PropertyGroup>
      <RewriteCmd>dotnet ../Generator.Rewrite/bin/$(Configuration)/netcoreapp3.0/Generator.Rewrite.dll</RewriteCmd>
      <DebugOpt Condition="'$(Configuration)' == 'Debug'">--debug</DebugOpt>
    </PropertyGroup>
    <Exec Command="$(RewriteCmd) --assembly $(TargetPath) --dllimport $(DebugOpt)" />
  </Target>

</Project>